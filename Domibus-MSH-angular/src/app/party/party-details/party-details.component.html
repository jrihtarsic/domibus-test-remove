<h2 mat-dialog-title>Party</h2>

<mat-dialog-content style="width:75vw;height:75vh;padding-top:25px;">
  <form #myForm="ngForm">
    <div>
      <mat-card>
        <mat-card-content>
          <div class="panel">
            <mat-form-field style="width:100%">
              <input matInput placeholder="Name" name="name" id="name_id_detail" [(ngModel)]="party.name" #party_name="ngModel"
                     required [maxlength]="255">
            </mat-form-field>
            <mat-form-field style="width:100%">
              <input matInput placeholder="End Point" name="endPoint" id="endPoint_id_detail" [(ngModel)]="party.endpoint" #party_endPoint="ngModel"
                     required [maxlength]="255" [pattern]="endpointPattern">
              <div *ngIf="party_endPoint.dirty && party_endPoint.hasError('pattern')" style="color:red; font-size: 70%">
                Endpoint should follow the URL pattern<br>
              </div>
            </mat-form-field>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    <div>
      <mat-card>
        <mat-card-header>
          <mat-card-title>Certificate</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="panel">
            <fieldset [disabled]="true" style="border: none;">
              <mat-form-field style="width:100%">
                <input matInput placeholder="Subject Name" name="subjectName" value="{{party.certificate?.subject}}" id="subjectName_id">
              </mat-form-field>
              <mat-form-field style="width:40%">
                <input matInput placeholder="Valid From" name="validityFrom" value="{{party.certificate?.validFrom | domibusDate: dateFormat}}" id="validityFrom_id">
              </mat-form-field>
              <mat-form-field style="width:40%">
                <input matInput placeholder="Valid To" name="validityTo" value="{{party.certificate?.validUntil | domibusDate: dateFormat}}" id="validityTo_id">
              </mat-form-field>
              <mat-form-field style="width:100%">
                <input matInput placeholder="Issuer" name="issuer" value="{{party.certificate?.issuer}}" id="issuer_id">
              </mat-form-field>
              <mat-form-field style="width:100%">
                <input matInput placeholder="Fingerprints" name="fingerPrint" value="{{party.certificate?.fingerprints}}" id="fingerPrint_id">
              </mat-form-field>
            </fieldset>
            <label class="custom-file-upload">
              <input #fileInput type="file" id="custom-file-upload" accept=".cer" (change)="uploadCertificate()">
              <span class="custom-file-upload-inner">Import</span>
            </label>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    <div>
      <mat-card>
        <mat-card-header>
          <mat-card-title [ngClass]="{ 'invalid': identifiers.length == 0}">Identifiers</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="panel">
            <ngx-datatable
              id="identifierTable"
              class="material striped"
              [rows]="identifiers"
              [selected]="selectedIdentifiers"
              [selectionType]="'single'"
              [columnMode]="'force'"
              [columns]="identifiersRowColumnPicker.selectedColumns"
              [headerHeight]="50"
              [footerHeight]="50"
              [rowHeight]="'auto'"
              [externalPaging]="false"
              [externalSorting]="false"
              [count]="identifiers.length"
              (activate)="onActivate($event)"
            >
            </ngx-datatable>

            <div>
              <button mat-raised-button (click)="addIdentifier()" color="primary">
                <mat-icon>add</mat-icon>
                <span>New</span>
              </button>
              <button mat-raised-button (click)="editIdentifier()" color="primary"
                      [disabled]="selectedIdentifiers.length==0">
                <mat-icon>edit</mat-icon>
                <span>Edit</span>
              </button>
              <button mat-raised-button (click)="removeIdentifier()" color="primary"
                      [disabled]="selectedIdentifiers.length==0">
                <mat-icon>delete</mat-icon>
                <span>Delete</span>
              </button>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
    <div>
      <mat-card>
        <mat-card-header>
          <mat-card-title>Processes</mat-card-title>
        </mat-card-header>
        <mat-card-content>
          <div class="panel">
            <ngx-datatable
              id="processTable"
              class="material striped"
              [rows]="processesRows"
              [columnMode]="'force'"
              [headerHeight]="50"
              [footerHeight]="50"
              [rowHeight]="'auto'"
              [scrollbarV]="false"
              [scrollbarH]="false"
              [externalPaging]="false"
              [externalSorting]="false"
              [count]="processesRows.length"
            >
              <ngx-datatable-column name="Process" prop="name"></ngx-datatable-column>

              <ngx-datatable-column>
                <ng-template ngx-datatable-header-template>
                  Initiator
                </ng-template>
                <ng-template ngx-datatable-cell-template let-row="row" let-value="row.isInitiator">
                  <mat-checkbox [checked]="row.isInitiator" (change)="row.isInitiator = !row.isInitiator"></mat-checkbox>
                </ng-template>
              </ngx-datatable-column>

              <ngx-datatable-column>
                <ng-template ngx-datatable-header-template>
                  Responder
                </ng-template>
                <ng-template ngx-datatable-cell-template let-row="row" let-value="value">
                  <mat-checkbox [checked]="row.isResponder" (change)="row.isResponder = !row.isResponder"></mat-checkbox>
                </ng-template>
              </ngx-datatable-column>
            </ngx-datatable>
          </div>
        </mat-card-content>
      </mat-card>
    </div>


    <button mat-raised-button (click)="ok()" color="primary"
            [disabled]="party_name.invalid || party_endPoint.invalid || identifiers.length == 0">
      <span>OK</span>
    </button>
    <button mat-raised-button (click)="cancel()" color="primary">
      <span>Cancel</span>
    </button>
  </form>
</mat-dialog-content>

