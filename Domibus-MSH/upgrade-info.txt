Domibus 3.3-RC1 (from 3.2.1):
               Replace the Domibus war and the plugin(s) jar(s) into "\domibus\conf\domibus\plugins\lib"
               - in the file pom.xml of the custom plugin maven module:
                   o remove the following dependency:
                         <dependency>
                            <groupId>commons-logging</groupId>
                            <artifactId>commons-logging</artifactId>
                            <scope>provided</scope>
                        </dependency>
                   o add the following dependency:
                         <dependency>
                            <groupId>eu.domibus</groupId>
                            <artifactId>domibus-logging</artifactId>
                        </dependency>
               - in the custom plugin module source code replace all declarations of the logger:
                   o Before
                      eg: private static final Log LOG = LogFactory.getLog(BackendWebServiceImpl.class);
                   o Before
                      eg: private static final DomibusLogger LOG = DomibusLoggerFactory.getLogger(BackendWebServiceImpl.class);
               - in the location "\conf\domibus" delete the log4j.properties file and copy the logback.xml distributed in the domibus configuration specific to each server
               - in file "\conf\domibus\plugins\config\ws-plugin.xml" locate the following section and add the interceptors:
                    <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">
                        ........................
                         <jaxws:outInterceptors>
                            <ref bean="clearAuthenticationMDCInterceptor"/>
                        </jaxws:outInterceptors>
                        <jaxws:outFaultInterceptors>
                            <ref bean="clearAuthenticationMDCInterceptor"/>
                        </jaxws:outFaultInterceptors>

                    </jaxws:endpoint>

               - in file "\conf\domibus\domibus-configuration.xml"
                    o   add   <prop key="domibus.listPendingMessages.maxCount">500</prop>
                    o   add   <prop key="domibus.sendMessage.messageIdPattern">^[\x20-\x7E]*$</prop>
                    o   add   <prop key="domibus.dispatcher.connectionTimeout">240000</prop>
                    o   add   <prop key="domibus.dispatcher.receiveTimeout">240000</prop>
                    o   increase the value of the domibus.msh.retry.tolerance to 10800000 miliseconds: <prop key="domibus.msh.retry.tolerance">10800000</prop>
               - [Tomcat only] in file "\conf\domibus\domibus-datasources.xml" add the following bean(please adapt the values for for host, port, username and password properties according to your database schema):
                   o for MySQL:
                       <bean id="domibusJDBC-nonXADataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
                           <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
                           <property name="url" value="jdbc:mysql://localhost:3306/domibus_schema?useSSL=false"/>
                           <property name="username" value="edelivery_username"/>
                           <property name="password" value="edelivery_password"/>
                       </bean>
                   o for Oracle:
                       <bean id="domibusJDBC-nonXADataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
                          <property name="driverClassName" value="oracle.jdbc.OracleDriver"/>
                          <property name="URL" value="jdbc:oracle:thin:@127.0.0.1:1521:xe"/>
                          <property name="username" value="edelivery_username"/>
                          <property name="password" value="edelivery_password"/>
                       </bean>
               - [Tomcat only]
                   - in file "\conf\domibus\domibus-datasources.xml" add the following bean(please adapt the values for for host, port, username and password properties according to your database schema):
                       o for MySQL:
                           <bean id="domibusJDBC-nonXADataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
                               <property name="driverClassName" value="com.mysql.jdbc.Driver"/>
                               <property name="url" value="jdbc:mysql://localhost:3306/domibus_schema?useSSL=false"/>
                               <property name="username" value="edelivery_username"/>
                               <property name="password" value="edelivery_password"/>
                           </bean>
                       o for Oracle:
                           <bean id="domibusJDBC-nonXADataSource" class="org.springframework.jdbc.datasource.DriverManagerDataSource">
                              <property name="driverClassName" value="oracle.jdbc.OracleDriver"/>
                              <property name="URL" value="jdbc:oracle:thin:@127.0.0.1:1521:xe"/>
                              <property name="username" value="edelivery_username"/>
                              <property name="password" value="edelivery_password"/>
                           </bean>
                   - in file "conf\domibus\persistence.xml"  remove from the <persistence-unit> tag the following entry:
                           <class>eu.domibus.plugin.webService.entity.AuthenticationEntry</class>
                - [WebLogic only]
                   o execute the WLST API script(from "\conf\domibus\scripts\upgrades") 3.2.1-to-3.3-RC1-WeblogicSingleServer.properties for single server deployment or 3.2.1-to-3.3-RC1-WeblogicCluster.properties for cluster deployment
                   o in file "\conf\domibus\domibus-datasources.xml" add the following bean:
                         <bean id="domibusJDBC-nonXADataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
                            <property name="jndiName" value="jdbc/cipaeDeliveryNonXADs"/>
                        </bean>
                - [WildFly only]
                    o in file "cef_edelivery_path\domibus\standalone\configuration\standalone-full.xml":
                     - add the following datasource(MySQL or Oracle) in the datasources section
                        (please adapt the values for host, port, username and password properties according to your database schema):

                         <subsystem xmlns="urn:jboss:domain:datasources:3.0">
                            <datasources>
                                ........................
                                <!-- MySQL -->
                                <datasource jndi-name="java:/jdbc/cipaeDeliveryNonXADs" pool-name="eDeliveryMysqlNonXADS" enabled="true" use-ccm="true">
                                    <connection-url>jdbc:mysql://localhost:3306/domibus_schema</connection-url>
                                    <driver-class>com.mysql.jdbc.Driver</driver-class>
                                    <driver>com.mysql</driver>
                                    <security>
                                        <user-name>edelivery_username</user-name>
                                        <password>edelivery_password</password>
                                    </security>
                                    <validation>
                                        <valid-connection-checker class-name="org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLValidConnectionChecker"/>
                                        <background-validation>true</background-validation>
                                        <exception-sorter class-name="org.jboss.jca.adapters.jdbc.extensions.mysql.MySQLExceptionSorter"/>
                                    </validation>
                                </datasource>

                                <!-- Oracle -->
                                 <datasource jta="true" jndi-name="java:/jdbc/cipaeDeliveryNonXADs" pool-name="eDeliveryOracleNonXADS" enabled="true" use-ccm="true">
                                    <connection-url>jdbc:oracle:thin:@localhost:1521:xe</connection-url>
                                    <driver-class>oracle.jdbc.OracleDriver</driver-class>
                                    <driver>com.oracle</driver>
                                    <security>
                                        <user-name>edelivery_username</user-name>
                                        <password>edelivery_password</password>
                                    </security>
                                    <validation>
                                        <valid-connection-checker class-name="org.jboss.jca.adapters.jdbc.extensions.oracle.OracleValidConnectionChecker"/>
                                        <background-validation>true</background-validation>
                                        <stale-connection-checker class-name="org.jboss.jca.adapters.jdbc.extensions.oracle.OracleStaleConnectionChecker"/>
                                        <exception-sorter class-name="org.jboss.jca.adapters.jdbc.extensions.oracle.OracleExceptionSorter"/>
                                    </validation>
                                </datasource>
                                ........................
                            </datasources>
                         </subsystem>
                     - add the following executor services in the following section:
                            <subsystem xmlns="urn:jboss:domain:ee:3.0">
                                ........................
                                <concurrent>
                                    ........................
                                    <managed-executor-services>
                                        <managed-executor-service name="domibusExecutorService" jndi-name="java:jboss/ee/concurrency/executor/DomibusExecutorService" context-service="default" hung-task-threshold="60000" core-threads="5" max-threads="25" keepalive-time="5000"/>
                                    </managed-executor-services>
                                    <managed-executor-services>
                                        <managed-executor-service name="quartzExecutorService" jndi-name="java:jboss/ee/concurrency/executor/QuartzExecutorService" context-service="default" hung-task-threshold="0" long-running-tasks="true" core-threads="5" max-threads="25" keepalive-time="5000"/>
                                    </managed-executor-services>
                                     ........................
                                 </concurrent>
                                 ........................
                            <subsystem xmlns="urn:jboss:domain:ee:3.0">
                    o in file "\conf\domibus\domibus-datasources.xml" add the following bean:
                         <bean id="domibusJDBC-nonXADataSource" class="org.springframework.jndi.JndiObjectFactoryBean">
                            <property name="jndiName" value="jdbc/cipaeDeliveryNonXADs"/>
                         </bean>
               - [MySQL only] For all installations of MySQL execute the SQL commands in the file mysql5innoDb-3.2-to-3.3-migration.ddl
                              For each Domibus MySQL schema present execute the command: alter schema `your_domibus_schema_name` default charset=utf8 collate=utf8_bin;
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.2.2:
               - Replace the war file and the default plugins: domibus-default-ws-plugin and domibus-default-jms-plugin jar files
               - Add the following lines to conf/domibus/internal/ehcache.xml
                   	<cache name="lookupInfo"
                          maxBytesLocalHeap="5m"
                          timeToLiveSeconds="3600"
                          overflowToDisk="false">
                    </cache>
               - To use the Dynamic Discovery copy conf/domibus/policies/eDeliveryPolicy_CA.xml to conf/domibus/policies
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.2.1:
               - [WebLogic only]
                  o execute the WLST API script(from "\conf\domibus\scripts\upgrades") 3.2-to-3.2.1-WeblogicSingleServer.properties for single server deployment or 3.2-to-3.2.1-WeblogicCluster.properties for cluster deployment
                  o In the WebLogic console, in the page "Home >Summary of Security Realms >myrealm",  enable the flag "Use Authorization Providers to Protect JMX Access" flag; for more info please check the Administration Guide
                  o In the WebLogic console, in the page "Home >Summary of JDBC Data Sources >cipaeDeliveryDs", tab "Configuration/Connection Pool/Advanced"
                    enable the "Test Connections On Reserve" flag and add "SQL SELECT 1 FROM DUAL" in the "Test Table Name"
               - Replace the war file
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.2 (from 3.1.1):
                Run the appropriate DB migration script.
                Update the configuration file following these steps:
                -  in file "\domibus\conf\domibus\plugins\config\ws-plugin.xml":
                        o   replace
                               <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">
                               .......
                               </jaxws:endpoint>

                               with

                              <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">

                                      <jaxws:properties>
                                          <entry key="schema-validation-enabled" value="true"/>
                                          <entry key="mtom-enabled" value="false"/>
                                      </jaxws:properties>

                                      <jaxws:schemaLocations>
                                          <jaxws:schemaLocation>schemas/domibus-header.xsd</jaxws:schemaLocation>
                                          <jaxws:schemaLocation>schemas/domibus-backend.xsd</jaxws:schemaLocation>
                                          <jaxws:schemaLocation>schemas/xml.xsd</jaxws:schemaLocation>
                                          <jaxws:schemaLocation>schemas/xmlmime.xsd</jaxws:schemaLocation>
                                      </jaxws:schemaLocations>
                                      <jaxws:inInterceptors>
                                            <ref bean="customAuthenticationInterceptor"/>
                                      </jaxws:inInterceptors>

                              </jaxws:endpoint>
                -  in file "\domibus\conf\domibus\internal\ehcache.xml":
                        o   add <cache name="certValidationByAlias" maxBytesLocalHeap="5m" timeToLiveSeconds="3600" overflowToDisk="false"/>
                        o   add <cache name="crlByCert" maxBytesLocalHeap="5m" timeToLiveSeconds="3600" overflowToDisk="false"/>
                -  in file "\domibus\conf\domibus\domibus-configuration.xml":
                        o   replace class="eu.domibus.common.dao.CachingPModeProvider"/> by class="eu.domibus.ebms3.common.dao.CachingPModeProvider"/> or by class="eu.domibus.common.dao.PModeDao"/> if you are using Oracle DB
                        o   add <prop key="domibus.certificate.validation.enabled">true</prop>
                        o   add <prop key="domibus.jms.internalQueue.expression">.*domibus\.(internal|DLQ|backend\.jms|notification\.jms|notification\.webservice|notification\.kerkovi).*</prop>
                        o   only for Tomcat users: add <prop key="activeMQ.JMXURL">service:jmx:rmi://localhost:1198/jndi/rmi://localhost:1199/jmxrmi</prop>
                -  in file conf/domibus/domibus-security.xml
                        o   replace all from the comment
                                 <!-- Administration GUI user credentials-->
                                 ...
                             with:
                                <!-- Administration GUI user credentials-->
                                 <bean name="bcryptEncoder"
                                       class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>
                                 <sec:authentication-manager>
                                     <sec:authentication-provider ref="allowAllAuthenticationProvider"/>
                                 </sec:authentication-manager>
                                 <sec:authentication-manager id="authenticationManagerForAdminConsole">
                                     <sec:authentication-provider>
                                         <sec:password-encoder ref="bcryptEncoder"/>
                                         <sec:user-service>
                                             <sec:user name="user" password="$2a$10$HApapHvDStTEwjjneMCvxuqUKVyycXZRfXMwjU0rRmaWMsjWQp/Zu"
                                                       authorities="ROLE_USER"/>
                                             <sec:user name="admin" password="$2a$10$5uKS72xK2ArGDgb2CwjYnOzQcOmB7CPxK6fz2MGcDBM9vJ4rUql36"
                                                       authorities="ROLE_USER, ROLE_ADMIN"/>
                                         </sec:user-service>
                                     </sec:authentication-provider>
                                 </sec:authentication-manager>
                                 <sec:global-method-security pre-post-annotations="enabled"/>

                -  [Tomcat only] in file "\domibus\conf\domibus\domibus-datasources.xml":
                        o   replace  <amq:xaConnectionFactory id="xaJmsConnectionFactory" brokerURL="tcp://localhost:61616" userName="domibus" password="changeit"/>    with

                                <amq:xaConnectionFactory id="xaJmsConnectionFactory"
                                                 brokerURL="tcp://localhost:61616"
                                                 userName="domibus" password="changeit">
                                    <!-- do not remove this! otherwise the redeliveryPolicy configured in activemq.xml will be ignored -->
                                    <amq:redeliveryPolicy>
                                        <amq:redeliveryPolicy/>
                                    </amq:redeliveryPolicy>
                                </amq:xaConnectionFactory>

                - [Tomcat only] in file conf/domibus/persistence.xml, add to the <persistence-unit> tag:
                                <class>eu.domibus.plugin.webService.entity.AuthenticationEntry</class>

                If you are using samples keystores, please update them since they are expiring on the 26th of October 2016.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.2 (from RC1):
                  Run the appropriate DB migration script.
                  Replace domibus.war and the plugin(s) jar(s) into \domibus\conf\domibus\plugins\lib"
                  Update the configuration file following these steps:
                  -   in file "\domibus\conf\domibus\plugins\config\ws-plugin.xml":
                          o   remove <bean id="defaultTransformer" class="eu.domibus.plugin.webService.impl.StubDtoTransformer"/>
                          o   replace
                               <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">
                               .......
                               </jaxws:endpoint>

                               with

                              <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">

                                      <jaxws:properties>
                                          <entry key="schema-validation-enabled" value="true"/>
                                          <entry key="mtom-enabled" value="false"/>
                                      </jaxws:properties>

                                      <jaxws:schemaLocations>
                                          <jaxws:schemaLocation>schemas/domibus-header.xsd</jaxws:schemaLocation>
                                          <jaxws:schemaLocation>schemas/domibus-backend.xsd</jaxws:schemaLocation>
                                          <jaxws:schemaLocation>schemas/xml.xsd</jaxws:schemaLocation>
                                          <jaxws:schemaLocation>schemas/xmlmime.xsd</jaxws:schemaLocation>
                                      </jaxws:schemaLocations>

                                      <jaxws:inInterceptors>
                                            <ref bean="customAuthenticationInterceptor"/>
                                      </jaxws:inInterceptors>

                              </jaxws:endpoint>
                  -  in file conf/domibus/internal/ehcache.xml, add
                                            <cache name="crlByCert" 
                                                maxBytesLocalHeap="5m" 
                                                timeToLiveSeconds="3600" 
                                                overflowToDisk="false">
                                             </cache>
                -  in file conf/domibus/domibus-security.xml
                        o   replace all from the comment
                                 <!-- Administration GUI user credentials-->
                                 ...
                             with:
                                <!-- Administration GUI user credentials-->
                                 <bean name="bcryptEncoder"
                                       class="org.springframework.security.crypto.bcrypt.BCryptPasswordEncoder"/>
                                 <sec:authentication-manager>
                                     <sec:authentication-provider ref="allowAllAuthenticationProvider"/>
                                 </sec:authentication-manager>
                                 <sec:authentication-manager id="authenticationManagerForAdminConsole">
                                     <sec:authentication-provider>
                                         <sec:password-encoder ref="bcryptEncoder"/>
                                         <sec:user-service>
                                             <sec:user name="user" password="$2a$10$HApapHvDStTEwjjneMCvxuqUKVyycXZRfXMwjU0rRmaWMsjWQp/Zu"
                                                       authorities="ROLE_USER"/>
                                             <sec:user name="admin" password="$2a$10$5uKS72xK2ArGDgb2CwjYnOzQcOmB7CPxK6fz2MGcDBM9vJ4rUql36"
                                                       authorities="ROLE_USER, ROLE_ADMIN"/>
                                         </sec:user-service>
                                     </sec:authentication-provider>
                                 </sec:authentication-manager>
                                 <sec:global-method-security pre-post-annotations="enabled"/>

                  - [Tomcat only] in file conf/domibus/persistence.xml, add to the <persistence-unit> tag:
                                  <class>eu.domibus.plugin.webService.entity.AuthenticationEntry</class>
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.2 RC1:   Run the appropriate DB migration script.
                    Replace domibus.war and the plugin(s) jar(s) into \domibus\conf\domibus\plugins\lib"
                    For Tomcat installations only, the activemq.xml file has to be replaced and re-configured according to your environment (transportConnector uri, authenticationUser, redeliveryPolicy).
                    Update the configuration file following these steps:
                    -   in file "\domibus\conf\domibus\plugins\config\ws-plugin.xml":
                            o   add <bean id="defaultTransformer" class="eu.domibus.plugin.webService.impl.StubDtoTransformer"/> (as an element in the node beans)
                            o   replace
                                 <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">
                                 .......
                                 </jaxws:endpoint>

                                 with

                                <jaxws:endpoint id="backendInterfaceEndpoint" implementor="#backendWebservice" address="/backend">

                                    <jaxws:properties>
                                        <entry key="schema-validation-enabled" value="true"/>
                                        <entry key="mtom-enabled" value="true"/>
                                    </jaxws:properties>

                                    <jaxws:schemaLocations>
                                        <jaxws:schemaLocation>schemas/domibus-submission.xsd</jaxws:schemaLocation>
                                        <jaxws:schemaLocation>schemas/xml.xsd</jaxws:schemaLocation>
                                        <jaxws:schemaLocation>schemas/domibus-backend.xsd</jaxws:schemaLocation>
                                        <jaxws:schemaLocation>schemas/xmlmime.xsd</jaxws:schemaLocation>
                                    </jaxws:schemaLocations>

                                </jaxws:endpoint>

                    -   in file "\domibus\conf\domibus\internal\ehcache.xml":
                            o   add <cache name="certValidationByAlias" maxBytesLocalHeap="5m" timeToLiveSeconds="3600" overflowToDisk="false"/>
                    -   in file "\domibus\conf\domibus\domibus-configuration.xml":
                            o   replace class="eu.domibus.common.dao.CachingPModeProvider"/> by class="eu.domibus.ebms3.common.dao.CachingPModeProvider"/> or by class="eu.domibus.common.dao.PModeDao"/> if you are using Oracle DB
                            o   add <prop key="domibus.certificate.validation.enabled">true</prop>
                            o   add <prop key="domibus.jms.internalQueue.expression">.*domibus\.(internal|DLQ|backend\.jms|notification\.jms|notification\.webservice|notification\.kerkovi).*</prop>
                            o   only for Tomcat users: add <prop key="activeMQ.JMXURL">service:jmx:rmi://localhost:1198/jndi/rmi://localhost:1199/jmxrmi</prop>
                    -   only for Tomcat users: in file "\domibus\conf\domibus\domibus-datasources.xml":
                            o   replace  <amq:xaConnectionFactory id="xaJmsConnectionFactory" brokerURL="tcp://localhost:61616" userName="domibus" password="changeit"/>    with

                                    <amq:xaConnectionFactory id="xaJmsConnectionFactory"
                                                     brokerURL="tcp://localhost:61616"
                                                     userName="domibus" password="changeit">
                                        <!-- do not remove this! otherwise the redeliveryPolicy configured in activemq.xml will be ignored -->
                                        <amq:redeliveryPolicy>
                                            <amq:redeliveryPolicy/>
                                        </amq:redeliveryPolicy>
                                    </amq:xaConnectionFactory>

                    If you are using samples keystores, please update them since they are expiring on the 26th of October 2016.

---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.1.1:      Replace the war. This release updated the type of one column for the MySQL db. Please run the migration script.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.1.0:      Re-install the domibus-security.xml and re-configure the properties according with the installed Truststore and Keystore.
                    For Tomcat installations only, the activemq.xml has to be re-installed and re-configured and the domibus-ActiveMQ-ThroughputLimiter jar can be deleted.
                    There have been some changes to the database, please use the new scripts.
                    Run the migration script if you are upgrading from 3.0 to 3.1
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.1 RC2:   Replace the war and jar(plugins) files. There have been some changes to the MessageFilter, please use a clean database.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.1 RC1:   Domibus 3.1 is a major release that has to be installed from scratch.
                    There have been some changes to the database, please use the new script.
                    There is a new PMode generation plugin available (BETA-3), use this to regenerate your PMode files
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.0 BETA-2: Replace the war file.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
Domibus 3.0 BETA-1: Domibus 3.0 is a major release that has to be installed from scratch. There is no available upgrade path.
---------------------------------------------------------------------------------------------------------------------------------------------------------------------------
