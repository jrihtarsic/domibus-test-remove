<?xml version="1.0" encoding="UTF-8" standalone="no"?>

<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.4.xsd">

    <changeSet id="MySQL_Collation_Update_1554" author="ArunRaj" dbms="mysql">
        <sql dbms="mysql">
            SET FOREIGN_KEY_CHECKS=0;
            ALTER TABLE QRTZ_TRIGGERS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_BLOB_TRIGGERS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_CRON_TRIGGERS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_JOB_DETAILS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_SIMPLE_TRIGGERS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_SIMPROP_TRIGGERS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_CALENDARS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_FIRED_TRIGGERS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_LOCKS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_PAUSED_TRIGGER_GRPS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE QRTZ_SCHEDULER_STATE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_ACTION CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_AGREEMENT CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_AUTHENTICATION_ENTRY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_BACKEND_FILTER CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_BUSINESS_PROCESS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_CONFIGURATION CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_ERROR CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_ERROR_HANDLING CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_ERROR_LOG CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_JOIN_PAYLOAD_PROFILE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_JOIN_PROCESS_INIT_PARTY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_JOIN_PROCESS_LEG CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_JOIN_PROCESS_RESP_PARTY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_JOIN_PROPERTY_SET CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_LEG CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_LEG_TB_MPC CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MEP CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MEP_BINDING CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MESSAGE_INFO CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MESSAGE_LOG CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MESSAGE_PROPERTY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MESSAGE_PROPERTY_SET CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MESSAGING CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_MPC CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PART_INFO CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PARTY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PARTY_ID CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PARTY_ID_TYPE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PARTY_IDENTIFIER CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PAYLOAD CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PAYLOAD_PROFILE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PROCESS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_PROPERTY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_RECEIPT CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_RECEIPT_DATA CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_RECEPTION_AWARENESS CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_RELIABILITY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_ROLE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_ROUTING_CRITERIA CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_SECURITY CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_SERVICE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_SIGNAL_MESSAGE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            ALTER TABLE TB_USER_MESSAGE CONVERT TO CHARACTER SET UTF8 COLLATE UTF8_BIN;
            SET FOREIGN_KEY_CHECKS=1;
        </sql>
    </changeSet>

    <changeSet author="ArunRaj" id="Add_Downloaded_1542">
        <addColumn tableName="TB_MESSAGE_LOG">
            <column name="DOWNLOADED" type="datetime" afterColumn="RECEIVED"/>
        </addColumn>
    </changeSet>

    <changeSet author="TiagoMiguel" id="EDelivery_1940">
        <createTable tableName="TB_MESSAGE_ACKNW">
            <column autoIncrement="true" name="ID_PK" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="MESSAGE_ID" type="VARCHAR(255)"/>
            <column name="FROM" type="VARCHAR(255)"/>
            <column name="TO" type="VARCHAR(255)"/>
            <column name="CREATED" type="DATETIME"/>
            <column name="ACKNOWLEDGED" type="DATETIME"/>
        </createTable>
        <createTable tableName="TB_MESSAGE_ACKNW_PROP">
            <column autoIncrement="true" name="ID_PK" type="INT">
                <constraints primaryKey="true"/>
            </column>
            <column name="PROPERTY_NAME" type="VARCHAR(255)"/>
            <column name="PROPERTY_VALUE" type="VARCHAR(255)"/>
            <column name="FK_MSG_ACKNOWLEDGE" type="INT"/>
        </createTable>
        <addForeignKeyConstraint baseColumnNames="FK_MSG_ACKNOWLEDGE" baseTableName="TB_MESSAGE_ACKNW_PROP"
                                 constraintName="FK_MSG_ACK_PROP_MSG_ACK" deferrable="false"
                                 initiallyDeferred="false" onDelete="NO ACTION" onUpdate="NO ACTION"
                                 referencedColumnNames="ID_PK" referencedTableName="TB_MESSAGE_ACKNW"/>
    </changeSet>

</databaseChangeLog>
